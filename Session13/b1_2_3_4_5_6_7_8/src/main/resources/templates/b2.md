# Quy tr√¨nh x√°c th·ª±c JWT (JWT Authentication Flow)

## ‚úÖ T·ªïng quan

JWT authentication l√† c∆° ch·∫ø x√°c th·ª±c ng∆∞·ªùi d√πng b·∫±ng c√°ch s·ª≠ d·ª•ng token thay v√¨ session. Quy tr√¨nh n√†y bao g·ªìm 3 giai ƒëo·∫°n ch√≠nh: **ƒêƒÉng nh·∫≠p**, **G·ª≠i token**, v√† **X√°c minh token**.

---

## üîÑ C√°c b∆∞·ªõc x√°c th·ª±c JWT gi·ªØa Client v√† Server

```
+--------+        1. ƒêƒÉng nh·∫≠p        +--------+
| Client | -------------------------> | Server |
+--------+                            +--------+
                                         |
                                         v
                                 2. T·∫°o JWT Token
                                         |
                                         v
+--------+       3. G·ª≠i token           +--------+
| Client | <-------------------------  | Server |
+--------+                             +--------+

+--------+       4. G·ª≠i request c√≥ token         +--------+
| Client | ------------------------------------> | Server |
+--------+                                       +--------+
                                                       |
                                                       v
                                        5. Ki·ªÉm tra token h·ª£p l·ªá?
                                                       |
                                                       v
                                     +------------------------+
                                     | N·∫øu h·ª£p l·ªá: tr·∫£ d·ªØ li·ªáu |
                                     +------------------------+
                                     | N·∫øu sai: tr·∫£ l·ªói 401    |
                                     +------------------------+
```

---

## üß© Chi ti·∫øt t·ª´ng b∆∞·ªõc

### B∆∞·ªõc 1: ƒêƒÉng nh·∫≠p (Authentication Request)
- **Client** g·ª≠i th√¥ng tin ƒëƒÉng nh·∫≠p (username/password) t·ªõi API `/login`.
- **Payload** th∆∞·ªùng ·ªü d·∫°ng JSON:
```json
{
  "username": "vymo",
  "password": "123456"
}
```

### B∆∞·ªõc 2: Server x√°c th·ª±c v√† t·∫°o JWT
- Server x√°c minh username/password v·ªõi c∆° s·ªü d·ªØ li·ªáu.
- N·∫øu h·ª£p l·ªá, server **t·∫°o JWT** ch·ª©a th√¥ng tin ng∆∞·ªùi d√πng (userId, role, exp...).
- K√Ω token b·∫±ng secret key ho·∫∑c private key (HS256 ho·∫∑c RS256).

V√≠ d·ª• payload:
```json
{
  "sub": "123456",
  "role": "USER",
  "exp": 1716988839
}
```

### B∆∞·ªõc 3: Tr·∫£ JWT v·ªÅ client
- Server g·ª≠i l·∫°i JWT trong **HTTP response body** ho·∫∑c header (tu·ª≥ ·ª©ng d·ª•ng).
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9..."
}
```

### B∆∞·ªõc 4: Client g·ª≠i request c√≥ k√®m token
- V·ªõi m·ªói request ti·∫øp theo, client g·ª≠i JWT token v√†o **Authorization Header**:

```
Authorization: Bearer <jwt-token>
```

### B∆∞·ªõc 5: Backend ki·ªÉm tra token
- Server **gi·∫£i m√£ (decode)** token:
    - Ki·ªÉm tra ch·ªØ k√Ω h·ª£p l·ªá (signature)
    - Ki·ªÉm tra th·ªùi h·∫°n (`exp`)
    - Ki·ªÉm tra c√°c claim (sub, role...)
- N·∫øu h·ª£p l·ªá ‚Üí x·ª≠ l√Ω request v√† tr·∫£ d·ªØ li·ªáu.
- N·∫øu kh√¥ng h·ª£p l·ªá ‚Üí tr·∫£ l·ªói 401 Unauthorized.

---

## üõ°Ô∏è ∆Øu ƒëi·ªÉm c·ªßa JWT authentication

- Stateless (kh√¥ng c·∫ßn l∆∞u session ph√≠a server)
- Token c√≥ th·ªÉ d√πng tr√™n nhi·ªÅu h·ªá th·ªëng (SSO)
- D·ªÖ t√≠ch h·ª£p cho RESTful API

---

## ‚ö†Ô∏è L∆∞u √Ω b·∫£o m·∫≠t

- Lu√¥n d√πng HTTPS ƒë·ªÉ truy·ªÅn token
- Kh√¥ng l∆∞u JWT trong localStorage n·∫øu c√≥ th·ªÉ ‚Üí d·ªÖ b·ªã XSS
- H·∫°n ch·∫ø th·ªùi gian s·ªëng c·ªßa token (`exp` ng·∫Øn)
- C√¢n nh·∫Øc c∆° ch·∫ø refresh token v√† revocation