# üîê Lu·ªìng x√°c th·ª±c v√† ph√¢n quy·ªÅn v·ªõi JWT

Quy tr√¨nh x√°c th·ª±c v√† ph√¢n quy·ªÅn ng∆∞·ªùi d√πng b·∫±ng JWT g·ªìm c√°c b∆∞·ªõc sau:

---

## ‚úÖ C√°c b∆∞·ªõc x·ª≠ l√Ω

### [1] Client g·ª≠i username/password ‚Üí `/login`
- Giao di·ªán login g·ª≠i th√¥ng tin ƒëƒÉng nh·∫≠p ƒë·∫øn API `/login` b·∫±ng `POST`
- V√≠ d·ª• payload:
```json
{
  "username": "john_doe",
  "password": "secret123"
}
```

---

### [2] Server ki·ªÉm tra th√¥ng tin ‚Üí sinh JWT k√®m `roles` ‚Üí tr·∫£ v·ªÅ client
- N·∫øu th√¥ng tin h·ª£p l·ªá, server s·∫Ω t·∫°o JWT ch·ª©a th√¥ng tin `sub`, `username`, `roles`, `iat`, `exp`...
- Tr·∫£ v·ªÅ client:
```json
{
  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6..."
}
```

---

### [3] Client l∆∞u JWT (localStorage, sessionStorage, cookie‚Ä¶)
- T√πy v√†o lo·∫°i app (SPA, PWA, native) m√† l∆∞u token v√†o:
    - `localStorage` (√≠t b·∫£o m·∫≠t h∆°n)
    - `sessionStorage` (m·∫•t sau khi t·∫Øt tab)
    - `cookie` (∆∞u ti√™n `HttpOnly`, `Secure` n·∫øu d√πng)

---

### [4] Client g·ª≠i JWT k√®m m·ªói request ‚Üí `Authorization: Bearer <token>`
- T·∫•t c·∫£ c√°c request sau ƒë√≥ ph·∫£i g·∫Øn header:
```
Authorization: Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6...
```

---

### [5] Backend middleware ki·ªÉm tra:
- ‚úÖ Token c√≥ h·ª£p l·ªá (ƒë√∫ng ƒë·ªãnh d·∫°ng, ƒë√∫ng ch·ªØ k√Ω)?
- ‚úÖ Token c√≤n h·∫°n (`exp`)?
- ‚úÖ Token c√≥ ƒë·ªß role ƒë·ªÉ truy c·∫≠p route y√™u c·∫ßu?
- N·∫øu **h·ª£p l·ªá** ‚Üí cho ph√©p x·ª≠ l√Ω controller
- N·∫øu **sai** ‚Üí tr·∫£ v·ªÅ l·ªói `401 Unauthorized` ho·∫∑c `403 Forbidden`

---

## üß© V√≠ d·ª• h·ªá th·ªëng ph√¢n quy·ªÅn

| Endpoint              | Vai tr√≤ ƒë∆∞·ª£c ph√©p truy c·∫≠p   |
|-----------------------|-------------------------------|
| `GET /posts`          | `USER`, `EDITOR`, `ADMIN`     |
| `POST /posts`         | `EDITOR`, `ADMIN`             |
| `DELETE /posts/{id}`  | `ADMIN`                       |

---

> H·ªá th·ªëng JWT gi√∫p x√°c th·ª±c v√† ph√¢n quy·ªÅn hi·ªáu qu·∫£ m√† kh√¥ng c·∫ßn l∆∞u session tr√™n server.