# ğŸ“› Xá»­ lÃ½ lá»—i JWT trong há»‡ thá»‘ng xÃ¡c thá»±c

TÃ i liá»‡u nÃ y mÃ´ táº£ cÃ¡c lá»—i thÆ°á»ng gáº·p khi sá»­ dá»¥ng JWT (JSON Web Token), cÃ¡ch server pháº£n há»“i, vÃ  cÃ¡c hÃ nh Ä‘á»™ng há»£p lÃ½ mÃ  client nÃªn thá»±c hiá»‡n khi gáº·p pháº£i.

---

## âš ï¸ CÃ¡c tÃ¬nh huá»‘ng lá»—i phá»• biáº¿n cá»§a JWT

| TÃ¬nh huá»‘ng lá»—i                     | MÃ´ táº£                                        | NguyÃªn nhÃ¢n                                  |
|----------------------------------|----------------------------------------------|----------------------------------------------|
| **1. JWT háº¿t háº¡n (Expired Token)** | Token Ä‘Ã£ vÆ°á»£t quÃ¡ thá»i háº¡n `exp`             | Token Ä‘Æ°á»£c phÃ¡t quÃ¡ lÃ¢u, ngÆ°á»i dÃ¹ng khÃ´ng tÆ°Æ¡ng tÃ¡c |
| **2. JWT bá»‹ sá»­a Ä‘á»•i (Tampered)**   | Token bá»‹ chá»‰nh sá»­a, khÃ´ng cÃ²n há»£p lá»‡         | Táº¥n cÃ´ng giáº£ máº¡o hoáº·c thay Ä‘á»•i payload/signature |
| **3. JWT khÃ´ng há»£p lá»‡ (Malformed)**| Token sai Ä‘á»‹nh dáº¡ng                          | Thiáº¿u pháº§n, sai cáº¥u trÃºc base64, khÃ´ng Ä‘á»§ 3 pháº§n |
| **4. KhÃ´ng cÃ³ JWT (Missing)**      | Request khÃ´ng cÃ³ JWT                         | NgÆ°á»i dÃ¹ng chÆ°a Ä‘Äƒng nháº­p hoáº·c thiáº¿u header |
| **5. JWT sai signature**           | Signature khÃ´ng xÃ¡c thá»±c Ä‘Æ°á»£c                | DÃ¹ng sai secret key hoáº·c token giáº£ máº¡o |
| **6. Token bá»‹ revoke**             | Token tá»«ng há»£p lá»‡ nhÆ°ng Ä‘Ã£ bá»‹ thu há»“i        | NgÆ°á»i dÃ¹ng Ä‘Ã£ logout hoáº·c vi pháº¡m chÃ­nh sÃ¡ch |

---

## ğŸ“¦ VÃ­ dá»¥ response tá»« server

### 1. Token háº¿t háº¡n
HTTP/1.1 401 Unauthorized
```json
{
  "error": "JWT_EXPIRED",
  "message": "Token has expired",
  "timestamp": "2025-07-24T20:15:00Z"
}
```

### 2. Token bá»‹ sá»­a Ä‘á»•i
HTTP/1.1 401 Unauthorized
```json
{
  "error": "JWT_INVALID",
  "message": "Token signature verification failed",
  "timestamp": "2025-07-24T20:15:00Z"
}
```

### 3. Token sai Ä‘á»‹nh dáº¡ng
HTTP/1.1 400 Bad Request
```json
{
  "error": "JWT_MALFORMED",
  "message": "Token format is invalid",
  "timestamp": "2025-07-24T20:15:00Z"
}
```

### 4. KhÃ´ng cÃ³ token
HTTP/1.1 401 Unauthorized
```json
{
  "error": "JWT_MISSING",
  "message": "Authorization header missing or empty",
  "timestamp": "2025-07-24T20:15:00Z"
}
```

---

## ğŸ’¡ HÃ nh Ä‘á»™ng phÃ¹ há»£p cho Client

| TÃ¬nh huá»‘ng           | HÃ nh Ä‘á»™ng Ä‘á» xuáº¥t |
|----------------------|-------------------|
| **JWT háº¿t háº¡n**       | - Tá»± Ä‘á»™ng logout<br>- Chuyá»ƒn hÆ°á»›ng vá» trang login<br>- ThÃ´ng bÃ¡o: *"PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i."* |
| **JWT bá»‹ sá»­a Ä‘á»•i**    | - Logout ngay<br>- Cáº£nh bÃ¡o ngÆ°á»i dÃ¹ng: *"CÃ³ dáº¥u hiá»‡u can thiá»‡p khÃ´ng há»£p lá»‡."* |
| **JWT khÃ´ng há»£p lá»‡**  | - ThÃ´ng bÃ¡o lá»—i Ä‘á»‹nh dáº¡ng<br>- Äá» xuáº¥t ngÆ°á»i dÃ¹ng Ä‘Äƒng nháº­p láº¡i |
| **KhÃ´ng cÃ³ JWT**      | - Chuyá»ƒn hÆ°á»›ng vá» login náº¿u request yÃªu cáº§u Ä‘Äƒng nháº­p |
| **Sai signature**     | - XÃ³a token khá»i localStorage<br>- YÃªu cáº§u Ä‘Äƒng nháº­p láº¡i |
| **Token bá»‹ revoke**   | - Logout báº¯t buá»™c<br>- ThÃ´ng bÃ¡o lÃ½ do bá»‹ thu há»“i (náº¿u cÃ³) |

---

## âœ… VÃ­ dá»¥ client (JavaScript)

```js
fetch("/api/protected-resource", {
  headers: {
    Authorization: `Bearer ${localStorage.getItem("jwt")}`
  }
})
.then(res => {
  if (res.status === 401 || res.status === 403) {
    localStorage.removeItem("jwt");
    alert("PhiÃªn Ä‘Äƒng nháº­p Ä‘Ã£ háº¿t háº¡n hoáº·c khÃ´ng há»£p lá»‡. Vui lÃ²ng Ä‘Äƒng nháº­p láº¡i.");
    window.location.href = "/login";
  }
  return res.json();
});
```

---

## ğŸ” GÃ³c nhÃ¬n báº£o máº­t

- KhÃ´ng Ä‘á»ƒ **thÃ´ng tin nháº¡y cáº£m** trong payload JWT (vÃ¬ chá»‰ Ä‘Æ°á»£c mÃ£ hÃ³a Base64, khÃ´ng Ä‘Æ°á»£c mÃ£ hÃ³a thá»±c sá»±).
- LuÃ´n Ä‘áº·t **thá»i gian sá»‘ng ngáº¯n** cho access token (`5-15 phÃºt`) vÃ  dÃ¹ng **refresh token** Ä‘á»ƒ kÃ©o dÃ i phiÃªn Ä‘Äƒng nháº­p.
- CÃ¢n nháº¯c **revoke token** phÃ­a server (dá»±a trÃªn danh sÃ¡ch blacklist hoáº·c cÆ¡ cháº¿ version).
- NÃªn ghi **log lá»—i xÃ¡c thá»±c** Ä‘á»ƒ phÃ¡t hiá»‡n táº¥n cÃ´ng hoáº·c hÃ nh vi báº¥t thÆ°á»ng.

---

> Náº¿u báº¡n cáº§n thÃªm `@ControllerAdvice` xá»­ lÃ½ lá»—i JWT cho Spring Boot hoáº·c sample code phÃ­a backend, cÃ³ thá»ƒ bá»• sung ngay.